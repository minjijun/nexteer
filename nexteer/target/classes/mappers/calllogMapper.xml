<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.nexteer.calllog">
	<select id="getCalllogIndex" resultType="Integer">
		select IFNULL(max(calllog_index),0)+1
		  from calllog
	</select>
	
	<insert id="registerCalllog">
		insert into calllog(calllog_index, company_index, member_index, company_customer_index, calllog_call_date, calllog_call_contents, calllog_register_date)
		values (#{calllog_index}, #{company_index}, #{member_index}, #{company_customer_index}, #{calllog_call_date}, #{calllog_call_contents}, now())
	</insert>
	
	<insert id="registerCalllogs" parameterType="java.util.List">
		insert into calllog(calllog_index, company_index, member_index, company_customer_index, calllog_call_date, calllog_call_contents, calllog_register_date)
		values
			<foreach item="item" index="index" collection="list" separator=",">
			    (#{item.calllog_index}, #{item.company_index}, #{item.member_index}, #{item.company_customer_index}, #{item.calllog_call_date}, #{item.calllog_call_contents}, now())       
			</foreach>
		ON DUPLICATE KEY UPDATE <!-- PK가 중복이면 UPDATE -->
			company_index = values(company_index), member_index = values(member_index), company_customer_index = values(company_customer_index), 
			calllog_call_date = values(calllog_call_date), calllog_call_contents = values(calllog_call_contents), calllog_modify_date = now()
	</insert>

	<select id="getCalllogList" parameterType="Integer" resultType="kr.co.nexteer.domain.CalllogVO">
		select c.*, m.member_name
		  from calllog c, member m
		 where company_index = #{company_index}
		   and c.member_index = m.member_index
		 order by calllog_index desc
	</select>
	
	<select id="getCalllog" parameterType="Integer" resultType="kr.co.nexteer.domain.CalllogVO">
		select *
		  from calllog
		 where calllog_index = #{calllog_index}
	</select>
		
	<update id="updateCalllog">
		update calllog
		   set company_customer_index = #{company_customer_index}, calllog_call_contents = #{calllog_call_contents}, calllog_modify_date = now()
		 where calllog_index = #{calllog_index}
	</update>

</mapper>